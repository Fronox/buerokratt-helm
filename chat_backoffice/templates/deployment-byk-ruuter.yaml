apiVersion: apps/v1
kind: Deployment
metadata:
  name: ruuter
spec:
  selector:
    matchLabels:
      app: ruuter
  template:
    metadata:
      labels:
        app: ruuter
    spec:
      containers:
        - name: ruuter
          image: ruuter  # TODO: change
          ports:
            - containerPort: 8080
              name: http
          volumeMounts:
            - name: dsl
              mountPath: /DSL
        initContainers:
          - name: dsl-installer
            image: alpine/git:2.36.3
            volumeMounts:
              - name: dsl
                mountPath: /root/DSL
            command: ["/bin/sh"]
            args:
              - "c"
              - "git clone https://github.com/buerokratt/Ruuter.git /tmp/Ruuter && mv /tmp/Ruuter/DSL /root/ && rm -rf /tmp/Ruuter"
      volumes:
        - name: dsl
          emptyDir: {}
